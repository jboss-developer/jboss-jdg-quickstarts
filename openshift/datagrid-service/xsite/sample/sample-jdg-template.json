{
  "apiVersion": "v1",
  "kind": "Template",
  "labels": {
    "template": "jdg"
  },
  "metadata": {
    "annotations": {
      "description": "JBoss Data Grid is a high performance, linearly scalable, key/value data grid solution. It provides many features to serve a variety of use cases.",
      "iconClass": "icon-datagrid",
      "tags": "database,datagrid,jboss",
      "openshift.io/display-name": "JBoss Data Grid",
      "openshift.io/provider-display-name": "Red Hat, Inc.",
      "openshift.io/documentation-url": "https://www.redhat.com/en/technologies/jboss-middleware/data-grid",
      "openshift.io/long-description": "This service has been designed for the Summit Demo",
      "openshift.io/support-url": "https://www.redhat.com/en/services/support"
    },
    "name": "jdg"
  },
  "objects": [
    {
      "kind": "ServiceAccount",
      "apiVersion": "v1",
      "metadata": {
        "name": "${APPLICATION_NAME}"
      }
    },
    {
      "kind": "RoleBinding",
      "apiVersion": "v1",
      "metadata": {
        "name": "${APPLICATION_NAME}-view"
      },
      "userNames": [
        "system:serviceaccount:${NAMESPACE}:${APPLICATION_NAME}"
      ],
      "groupNames": null,
      "subjects": [
        {
          "kind": "ServiceAccount",
          "name": "${APPLICATION_NAME}"
        }
      ],
      "roleRef": {
        "name": "view"
      }
    },
    {
      "kind": "ConfigMap",
      "apiVersion": "v1",
      "metadata": {
        "name": "${APPLICATION_NAME}-configuration",
        "creationTimestamp": null
      },
      "data": {
        "cloud.xml": "\u003c?xml version='1.0' encoding='UTF-8'?\u003e\n\n\u003cserver xmlns=\"urn:jboss:domain:5.0\"\u003e\n    \u003cextensions\u003e\n        \u003cextension module=\"org.infinispan.extension\"/\u003e\n        \u003cextension module=\"org.infinispan.server.endpoint\"/\u003e\n        \u003cextension module=\"org.jboss.as.connector\"/\u003e\n        \u003cextension module=\"org.jboss.as.deployment-scanner\"/\u003e\n        \u003cextension module=\"org.jboss.as.jdr\"/\u003e\n        \u003cextension module=\"org.jboss.as.jmx\"/\u003e\n        \u003cextension module=\"org.jboss.as.logging\"/\u003e\n        \u003cextension module=\"org.jboss.as.naming\"/\u003e\n        \u003cextension module=\"org.jboss.as.remoting\"/\u003e\n        \u003cextension module=\"org.jboss.as.security\"/\u003e\n        \u003cextension module=\"org.jboss.as.transactions\"/\u003e\n        \u003cextension module=\"org.jgroups.extension\"/\u003e\n        \u003cextension module=\"org.wildfly.extension.elytron\"/\u003e\n        \u003cextension module=\"org.wildfly.extension.io\"/\u003e\n    \u003c/extensions\u003e\n    \u003cmanagement\u003e\n        \u003csecurity-realms\u003e\n            \u003csecurity-realm name=\"ManagementRealm\"\u003e\n                \u003cauthentication\u003e\n                    \u003clocal default-user=\"$local\"/\u003e\n                    \u003cproperties path=\"mgmt-users.properties\" relative-to=\"jboss.server.config.dir\"/\u003e\n                \u003c/authentication\u003e\n                \u003cauthorization map-groups-to-roles=\"false\"\u003e\n                    \u003cproperties path=\"mgmt-groups.properties\" relative-to=\"jboss.server.config.dir\"/\u003e\n                \u003c/authorization\u003e\n            \u003c/security-realm\u003e\n            \u003csecurity-realm name=\"ApplicationRealm\"\u003e\n                \u003cserver-identities\u003e\n                    \u003cssl\u003e\n                        \u003ckeystore path=\"application.keystore\" relative-to=\"jboss.server.config.dir\" keystore-password=\"password\" alias=\"server\" key-password=\"password\" generate-self-signed-certificate-host=\"localhost\"/\u003e\n                    \u003c/ssl\u003e\n                \u003c/server-identities\u003e\n                \u003cauthentication\u003e\n                    \u003clocal default-user=\"$local\" allowed-users=\"*\"/\u003e\n                    \u003cproperties path=\"application-users.properties\" relative-to=\"jboss.server.config.dir\"/\u003e\n                \u003c/authentication\u003e\n                \u003cauthorization\u003e\n                    \u003cproperties path=\"application-roles.properties\" relative-to=\"jboss.server.config.dir\"/\u003e\n                \u003c/authorization\u003e\n            \u003c/security-realm\u003e\n        \u003c/security-realms\u003e\n        \u003caudit-log\u003e\n            \u003cformatters\u003e\n                \u003cjson-formatter name=\"json-formatter\"/\u003e\n            \u003c/formatters\u003e\n            \u003chandlers\u003e\n                \u003cfile-handler name=\"file\" formatter=\"json-formatter\" relative-to=\"jboss.server.data.dir\" path=\"audit-log.log\"/\u003e\n            \u003c/handlers\u003e\n            \u003clogger log-boot=\"true\" enabled=\"false\"\u003e\n                \u003chandlers\u003e\n                    \u003chandler name=\"file\"/\u003e\n                \u003c/handlers\u003e\n            \u003c/logger\u003e\n        \u003c/audit-log\u003e\n        \u003cmanagement-interfaces\u003e\n            \u003chttp-interface security-realm=\"ManagementRealm\"\u003e\n                \u003chttp-upgrade enabled=\"true\"/\u003e\n                \u003csocket-binding http=\"management-http\"/\u003e\n            \u003c/http-interface\u003e\n        \u003c/management-interfaces\u003e\n        \u003caccess-control\u003e\n            \u003crole-mapping\u003e\n                \u003crole name=\"SuperUser\"\u003e\n                    \u003cinclude\u003e\n                        \u003cuser name=\"$local\"/\u003e\n                    \u003c/include\u003e\n                \u003c/role\u003e\n            \u003c/role-mapping\u003e\n        \u003c/access-control\u003e\n    \u003c/management\u003e\n    \u003cprofile\u003e\n        \u003csubsystem xmlns=\"urn:jboss:domain:logging:3.0\"\u003e\n            \u003cconsole-handler name=\"CONSOLE\"\u003e\n                \u003clevel name=\"INFO\"/\u003e\n                \u003cformatter\u003e\n                    \u003cnamed-formatter name=\"COLOR-PATTERN\"/\u003e\n                \u003c/formatter\u003e\n            \u003c/console-handler\u003e\n            \u003cperiodic-rotating-file-handler name=\"FILE\" autoflush=\"true\"\u003e\n                \u003cformatter\u003e\n                    \u003cnamed-formatter name=\"PATTERN\"/\u003e\n                \u003c/formatter\u003e\n                \u003cfile relative-to=\"jboss.server.log.dir\" path=\"server.log\"/\u003e\n                \u003csuffix value=\".yyyy-MM-dd\"/\u003e\n                \u003cappend value=\"true\"/\u003e\n            \u003c/periodic-rotating-file-handler\u003e\n            \u003csize-rotating-file-handler name=\"HR-ACCESS-FILE\" autoflush=\"true\"\u003e\n                \u003cformatter\u003e\n                    \u003cnamed-formatter name=\"ACCESS-LOG\"/\u003e\n                \u003c/formatter\u003e\n                \u003cfile relative-to=\"jboss.server.log.dir\" path=\"hotrod-access.log\"/\u003e\n                \u003cappend value=\"true\"/\u003e\n                \u003crotate-size value=\"10M\"/\u003e\n                \u003cmax-backup-index value=\"10\"/\u003e\n            \u003c/size-rotating-file-handler\u003e\n            \u003csize-rotating-file-handler name=\"REST-ACCESS-FILE\" autoflush=\"true\"\u003e\n                \u003cformatter\u003e\n                    \u003cnamed-formatter name=\"ACCESS-LOG\"/\u003e\n                \u003c/formatter\u003e\n                \u003cfile relative-to=\"jboss.server.log.dir\" path=\"rest-access.log\"/\u003e\n                \u003cappend value=\"true\"/\u003e\n                \u003crotate-size value=\"10M\"/\u003e\n                \u003cmax-backup-index value=\"10\"/\u003e\n            \u003c/size-rotating-file-handler\u003e\n            \u003clogger category=\"com.arjuna\"\u003e\n                \u003clevel name=\"WARN\"/\u003e\n            \u003c/logger\u003e\n            \u003clogger category=\"org.jboss.as.config\"\u003e\n                \u003clevel name=\"DEBUG\"/\u003e\n            \u003c/logger\u003e\n            \u003c!-- On AWS we observe lots and lots of connection errors from LBs --\u003e\n            \u003clogger category=\"org.jgroups.protocols.TCP\"\u003e\n                \u003clevel name=\"ERROR\"/\u003e\n            \u003c/logger\u003e\n            \u003clogger category=\"org.infinispan.remoting.transport.jgroups.JGroupsTransport\"\u003e\n                \u003clevel name=\"DEBUG\"/\u003e\n            \u003c/logger\u003e\n            \u003clogger category=\"sun.rmi\"\u003e\n                \u003clevel name=\"WARN\"/\u003e\n            \u003c/logger\u003e\n            \u003clogger category=\"org.infinispan.HOTROD_ACCESS_LOG\" use-parent-handlers=\"false\"\u003e\n                \u003c!-- Set to TRACE to enable access logging for hot rod or use DMR --\u003e\n                \u003clevel name=\"INFO\"/\u003e\n                \u003chandlers\u003e\n                    \u003chandler name=\"HR-ACCESS-FILE\"/\u003e\n                \u003c/handlers\u003e\n            \u003c/logger\u003e\n            \u003clogger category=\"org.infinispan.REST_ACCESS_LOG\" use-parent-handlers=\"false\"\u003e\n                \u003c!-- Set to TRACE to enable access logging for rest or use DMR --\u003e\n                \u003clevel name=\"INFO\"/\u003e\n                \u003chandlers\u003e\n                    \u003chandler name=\"REST-ACCESS-FILE\"/\u003e\n                \u003c/handlers\u003e\n            \u003c/logger\u003e\n            \u003croot-logger\u003e\n                \u003clevel name=\"INFO\"/\u003e\n                \u003chandlers\u003e\n                    \u003chandler name=\"CONSOLE\"/\u003e\n                    \u003chandler name=\"FILE\"/\u003e\n                \u003c/handlers\u003e\n            \u003c/root-logger\u003e\n            \u003cformatter name=\"PATTERN\"\u003e\n                \u003cpattern-formatter pattern=\"%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c] (%t) %s%e%n\"/\u003e\n            \u003c/formatter\u003e\n            \u003cformatter name=\"COLOR-PATTERN\"\u003e\n                \u003cpattern-formatter pattern=\"%K{level}%d{HH:mm:ss,SSS} %-5p [%c] (%t) %s%e%n\"/\u003e\n            \u003c/formatter\u003e\n            \u003cformatter name=\"ACCESS-LOG\"\u003e\n                \u003cpattern-formatter pattern=\"%X{address} %X{user} [%d{dd/MMM/yyyy:HH:mm:ss z}] \u0026quot;%X{method} %m %X{protocol}\u0026quot; %X{status} %X{requestSize} %X{responseSize} %X{duration}%n\"/\u003e\n            \u003c/formatter\u003e\n        \u003c/subsystem\u003e\n        \u003csubsystem xmlns=\"urn:jboss:domain:deployment-scanner:2.0\"\u003e\n            \u003cdeployment-scanner path=\"deployments\" relative-to=\"jboss.server.base.dir\" scan-interval=\"5000\" runtime-failure-causes-rollback=\"${jboss.deployment.scanner.rollback.on.failure:false}\"/\u003e\n        \u003c/subsystem\u003e\n        \u003csubsystem xmlns=\"urn:jboss:domain:datasources:5.0\"\u003e\n            \u003cdatasources\u003e\n                \u003cdatasource jndi-name=\"java:jboss/datasources/ExampleDS\" pool-name=\"ExampleDS\" enabled=\"true\" use-java-context=\"true\"\u003e\n                    \u003cconnection-url\u003ejdbc:h2:mem:test;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE\u003c/connection-url\u003e\n                    \u003cdriver\u003eh2\u003c/driver\u003e\n                    \u003csecurity\u003e\n                        \u003cuser-name\u003esa\u003c/user-name\u003e\n                        \u003cpassword\u003esa\u003c/password\u003e\n                    \u003c/security\u003e\n                \u003c/datasource\u003e\n                \u003cdrivers\u003e\n                    \u003cdriver name=\"h2\" module=\"com.h2database.h2\"\u003e\n                        \u003cxa-datasource-class\u003eorg.h2.jdbcx.JdbcDataSource\u003c/xa-datasource-class\u003e\n                    \u003c/driver\u003e\n                \u003c/drivers\u003e\n            \u003c/datasources\u003e\n        \u003c/subsystem\u003e\n        \u003csubsystem xmlns=\"urn:wildfly:elytron:1.2\" final-providers=\"combined-providers\" disallowed-providers=\"OracleUcrypto\"\u003e\n            \u003cproviders\u003e\n                \u003caggregate-providers name=\"combined-providers\"\u003e\n                    \u003cproviders name=\"elytron\"/\u003e\n                    \u003cproviders name=\"openssl\"/\u003e\n                \u003c/aggregate-providers\u003e\n                \u003cprovider-loader name=\"elytron\" module=\"org.wildfly.security.elytron\"/\u003e\n                \u003cprovider-loader name=\"openssl\" module=\"org.wildfly.openssl\"/\u003e\n            \u003c/providers\u003e\n            \u003caudit-logging\u003e\n                \u003cfile-audit-log name=\"local-audit\" path=\"audit.log\" relative-to=\"jboss.server.log.dir\" format=\"JSON\"/\u003e\n            \u003c/audit-logging\u003e\n            \u003csecurity-domains\u003e\n                \u003csecurity-domain name=\"ApplicationDomain\" default-realm=\"ApplicationRealm\" permission-mapper=\"default-permission-mapper\"\u003e\n                    \u003crealm name=\"ApplicationRealm\" role-decoder=\"groups-to-roles\"/\u003e\n                    \u003crealm name=\"local\"/\u003e\n                \u003c/security-domain\u003e\n                \u003csecurity-domain name=\"ManagementDomain\" default-realm=\"ManagementRealm\" permission-mapper=\"default-permission-mapper\"\u003e\n                    \u003crealm name=\"ManagementRealm\" role-decoder=\"groups-to-roles\"/\u003e\n                    \u003crealm name=\"local\" role-mapper=\"super-user-mapper\"/\u003e\n                \u003c/security-domain\u003e\n            \u003c/security-domains\u003e\n            \u003csecurity-realms\u003e\n                \u003cidentity-realm name=\"local\" identity=\"$local\"/\u003e\n                \u003cproperties-realm name=\"ApplicationRealm\"\u003e\n                    \u003cusers-properties path=\"application-users.properties\" relative-to=\"jboss.server.config.dir\" digest-realm-name=\"ApplicationRealm\"/\u003e\n                    \u003cgroups-properties path=\"application-roles.properties\" relative-to=\"jboss.server.config.dir\"/\u003e\n                \u003c/properties-realm\u003e\n                \u003cproperties-realm name=\"ManagementRealm\"\u003e\n                    \u003cusers-properties path=\"mgmt-users.properties\" relative-to=\"jboss.server.config.dir\" digest-realm-name=\"ManagementRealm\"/\u003e\n                    \u003cgroups-properties path=\"mgmt-groups.properties\" relative-to=\"jboss.server.config.dir\"/\u003e\n                \u003c/properties-realm\u003e\n            \u003c/security-realms\u003e\n            \u003cmappers\u003e\n                \u003csimple-permission-mapper name=\"default-permission-mapper\" mapping-mode=\"first\"\u003e\n                    \u003cpermission-mapping\u003e\n                        \u003cprincipal name=\"anonymous\"/\u003e\n                    \u003c/permission-mapping\u003e\n                    \u003cpermission-mapping match-all=\"true\"\u003e\n                        \u003cpermission class-name=\"org.wildfly.security.auth.permission.LoginPermission\"/\u003e\n                    \u003c/permission-mapping\u003e\n                \u003c/simple-permission-mapper\u003e\n                \u003cconstant-realm-mapper name=\"local\" realm-name=\"local\"/\u003e\n                \u003csimple-role-decoder name=\"groups-to-roles\" attribute=\"groups\"/\u003e\n                \u003cconstant-role-mapper name=\"super-user-mapper\"\u003e\n                    \u003crole name=\"SuperUser\"/\u003e\n                \u003c/constant-role-mapper\u003e\n            \u003c/mappers\u003e\n            \u003chttp\u003e\n                \u003chttp-authentication-factory name=\"management-http-authentication\" http-server-mechanism-factory=\"global\" security-domain=\"ManagementDomain\"\u003e\n                    \u003cmechanism-configuration\u003e\n                        \u003cmechanism mechanism-name=\"DIGEST\"\u003e\n                            \u003cmechanism-realm realm-name=\"ManagementRealm\"/\u003e\n                        \u003c/mechanism\u003e\n                    \u003c/mechanism-configuration\u003e\n                \u003c/http-authentication-factory\u003e\n                \u003chttp-authentication-factory name=\"application-http-authentication\" http-server-mechanism-factory=\"global\" security-domain=\"ApplicationDomain\"\u003e\n                    \u003cmechanism-configuration\u003e\n                        \u003cmechanism mechanism-name=\"BASIC\"\u003e\n                            \u003cmechanism-realm realm-name=\"Application Realm\"/\u003e\n                        \u003c/mechanism\u003e\n                        \u003cmechanism mechanism-name=\"FORM\"/\u003e\n                    \u003c/mechanism-configuration\u003e\n                \u003c/http-authentication-factory\u003e\n                \u003cprovider-http-server-mechanism-factory name=\"global\"/\u003e\n            \u003c/http\u003e\n            \u003csasl\u003e\n                \u003csasl-authentication-factory name=\"management-sasl-authentication\" sasl-server-factory=\"configured\" security-domain=\"ManagementDomain\"\u003e\n                    \u003cmechanism-configuration\u003e\n                        \u003cmechanism mechanism-name=\"JBOSS-LOCAL-USER\" realm-mapper=\"local\"/\u003e\n                        \u003cmechanism mechanism-name=\"DIGEST-MD5\"\u003e\n                            \u003cmechanism-realm realm-name=\"ManagementRealm\"/\u003e\n                        \u003c/mechanism\u003e\n                    \u003c/mechanism-configuration\u003e\n                \u003c/sasl-authentication-factory\u003e\n                \u003csasl-authentication-factory name=\"application-sasl-authentication\" sasl-server-factory=\"configured\" security-domain=\"ApplicationDomain\"\u003e\n                    \u003cmechanism-configuration\u003e\n                        \u003cmechanism mechanism-name=\"JBOSS-LOCAL-USER\" realm-mapper=\"local\"/\u003e\n                        \u003cmechanism mechanism-name=\"DIGEST-MD5\"\u003e\n                            \u003cmechanism-realm realm-name=\"ApplicationRealm\"/\u003e\n                        \u003c/mechanism\u003e\n                    \u003c/mechanism-configuration\u003e\n                \u003c/sasl-authentication-factory\u003e\n                \u003cconfigurable-sasl-server-factory name=\"configured\" sasl-server-factory=\"elytron\"\u003e\n                    \u003cproperties\u003e\n                        \u003cproperty name=\"wildfly.sasl.local-user.default-user\" value=\"$local\"/\u003e\n                    \u003c/properties\u003e\n                \u003c/configurable-sasl-server-factory\u003e\n                \u003cmechanism-provider-filtering-sasl-server-factory name=\"elytron\" sasl-server-factory=\"global\"\u003e\n                    \u003cfilters\u003e\n                        \u003cfilter provider-name=\"WildFlyElytron\"/\u003e\n                    \u003c/filters\u003e\n                \u003c/mechanism-provider-filtering-sasl-server-factory\u003e\n                \u003cprovider-sasl-server-factory name=\"global\"/\u003e\n            \u003c/sasl\u003e\n        \u003c/subsystem\u003e\n        \u003csubsystem xmlns=\"urn:infinispan:server:core:9.2\" default-cache-container=\"clustered\"\u003e\n            \u003ccache-container name=\"clustered\" default-cache=\"default\" statistics=\"true\"\u003e\n                \u003ctransport lock-timeout=\"60000\" /\u003e\n                \u003cglobal-state/\u003e\n                \u003creplicated-cache-configuration name=\"replicated\"\u003e\n                    \u003cbackups\u003e\n                        \u003cbackup site=\"Private\" strategy=\"ASYNC\" timeout=\"240000\"/\u003e\n                        \u003cbackup site=\"Azure\" strategy=\"ASYNC\" timeout=\"240000\"/\u003e\n                        \u003cbackup site=\"Amazon\" strategy=\"ASYNC\" timeout=\"240000\"/\u003e\n                     \u003c/backups\u003e\n                \u003c/replicated-cache-configuration\u003e\n                \u003cdistributed-cache-configuration name=\"distributed\"\u003e\n                    \u003cbackups\u003e\n                        \u003cbackup site=\"Private\" strategy=\"ASYNC\" timeout=\"240000\"/\u003e\n                        \u003cbackup site=\"Azure\" strategy=\"ASYNC\" timeout=\"240000\"/\u003e\n                        \u003cbackup site=\"Amazon\" strategy=\"ASYNC\" timeout=\"240000\"/\u003e\n                     \u003c/backups\u003e\n                \u003c/distributed-cache-configuration\u003e\n                \u003cdistributed-cache-configuration name=\"indexed\"\u003e\n                    \u003cbackups\u003e\n                        \u003cbackup site=\"Private\" strategy=\"ASYNC\" timeout=\"240000\"/\u003e\n                        \u003cbackup site=\"Azure\" strategy=\"ASYNC\" timeout=\"240000\"/\u003e\n                        \u003cbackup site=\"Amazon\" strategy=\"ASYNC\" timeout=\"240000\"/\u003e\n                     \u003c/backups\u003e\n                    \u003cindexing index=\"LOCAL\" auto-config=\"true\"/\u003e\n                \u003c/distributed-cache-configuration\u003e\n                \u003c!-- https://github.com/keycloak/keycloak-documentation/blob/master/server_installation/topics/operating-mode/crossdc.adoc --\u003e\n                \u003creplicated-cache-configuration name=\"sessions-cfg\" mode=\"SYNC\" start=\"EAGER\" batching=\"false\"\u003e\n                    \u003ctransaction mode=\"NON_DURABLE_XA\" locking=\"PESSIMISTIC\"/\u003e\n                    \u003clocking acquire-timeout=\"0\" /\u003e\n                    \u003cbackups\u003e\n                        \u003cbackup site=\"Private\" strategy=\"ASYNC\" timeout=\"240000\"/\u003e\n                        \u003cbackup site=\"Azure\" strategy=\"ASYNC\" timeout=\"240000\"/\u003e\n                        \u003cbackup site=\"Amazon\" strategy=\"ASYNC\" timeout=\"240000\"/\u003e\n                     \u003c/backups\u003e\n                \u003c/replicated-cache-configuration\u003e\n                \u003c!-- Temporary, will be exported to *-configuration as soon as we know what caches are needed --\u003e\n                \n                \u003c!-- https://github.com/keycloak/keycloak-documentation/blob/master/server_installation/topics/operating-mode/crossdc.adoc --\u003e\n                \u003creplicated-cache name=\"work\" configuration=\"sessions-cfg\"/\u003e\n                \u003creplicated-cache name=\"sessions\" configuration=\"sessions-cfg\"/\u003e\n                \u003creplicated-cache name=\"clientSessions\" configuration=\"sessions-cfg\"/\u003e\n                \u003creplicated-cache name=\"offlineSessions\" configuration=\"sessions-cfg\"/\u003e\n                \u003creplicated-cache name=\"offlineClientSessions\" configuration=\"sessions-cfg\"/\u003e\n                \u003creplicated-cache name=\"actionTokens\" configuration=\"sessions-cfg\"/\u003e\n                \u003creplicated-cache name=\"loginFailures\" configuration=\"sessions-cfg\"/\u003e\n                \u003creplicated-cache name=\"userStorage\" configuration=\"sessions-cfg\"/\u003e\n                \n                \u003c!-- Clement --\u003e\n                \u003creplicated-cache name=\"tasks\" configuration=\"replicated\"/\u003e\n                \u003creplicated-cache name=\"active\" configuration=\"replicated\"/\u003e\n                \u003cdistributed-cache name=\"players\" configuration=\"indexed\"/\u003e\n                \u003cdistributed-cache name=\"txs\" configuration=\"distributed\"/\u003e\n                \u003cdistributed-cache name=\"objects\" configuration=\"distributed\"/\u003e\n                \u003cdistributed-cache name=\"admin\" configuration=\"distributed\"/\u003e\n                \n                \u003c!-- Galder --\u003e\n                \u003cdistributed-cache name=\"scores\" configuration=\"distributed\"/\u003e\n                \n                \u003c!-- Test caches --\u003e\n                \u003cdistributed-cache name=\"default\" configuration=\"distributed\"/\u003e\n                \u003cdistributed-cache name=\"default0\" configuration=\"distributed\"/\u003e\n                \u003cdistributed-cache name=\"default1\" configuration=\"distributed\"/\u003e\n                \u003cdistributed-cache name=\"default2\" configuration=\"distributed\"/\u003e\n                \u003cdistributed-cache name=\"default3\" configuration=\"distributed\"/\u003e\n                \u003cdistributed-cache name=\"default4\" configuration=\"distributed\"/\u003e\n                \u003cdistributed-cache name=\"default5\" configuration=\"distributed\"/\u003e\n                \n                \u003cdistributed-cache name=\"indexed0\" configuration=\"indexed\"/\u003e\n                \u003cdistributed-cache name=\"indexed1\" configuration=\"indexed\"/\u003e\n                \u003cdistributed-cache name=\"indexed2\" configuration=\"indexed\"/\u003e\n                \u003cdistributed-cache name=\"indexed3\" configuration=\"indexed\"/\u003e\n                \u003cdistributed-cache name=\"indexed4\" configuration=\"indexed\"/\u003e\n                \u003cdistributed-cache name=\"indexed5\" configuration=\"indexed\"/\u003e\n                \n                \u003c!-- Defaults --\u003e\n                \u003creplicated-cache name=\"repl\" configuration=\"replicated\"/\u003e\n                \u003cdistributed-cache name=\"memcachedCache\"/\u003e\n            \u003c/cache-container\u003e\n        \u003c/subsystem\u003e\n        \u003csubsystem xmlns=\"urn:infinispan:server:endpoint:9.2\"\u003e\n            \u003chotrod-connector socket-binding=\"hotrod\" cache-container=\"clustered\"\u003e\n                \u003ctopology-state-transfer lazy-retrieval=\"false\" lock-timeout=\"1000\" replication-timeout=\"5000\"/\u003e\n            \u003c/hotrod-connector\u003e\n            \u003crest-connector socket-binding=\"rest\" cache-container=\"clustered\"\u003e\n                \u003ccors-rules\u003e\n                    \u003ccors-rule name=\"allow ALL\" allow-credentials=\"true\" max-age-seconds=\"2000\"\u003e\n                        \u003callowed-origins\u003e*\u003c/allowed-origins\u003e\n                        \u003callowed-methods\u003eGET,OPTIONS,POST,PUT,DELETE\u003c/allowed-methods\u003e\n                        \u003callowed-headers\u003eKey-Content-Type, Content-Type\u003c/allowed-headers\u003e\n                    \u003c/cors-rule\u003e\n                \u003c/cors-rules\u003e\n            \u003c/rest-connector\u003e\n        \u003c/subsystem\u003e\n        \u003csubsystem xmlns=\"urn:infinispan:server:jgroups:9.2\"\u003e\n            \u003cchannels default=\"cluster\"\u003e\n                \u003cchannel name=\"cluster\"/\u003e\n                \u003cchannel name=\"global\" stack=\"relay-global\"/\u003e\n            \u003c/channels\u003e\n            \u003cstacks default=\"${jboss.default.jgroups.stack:kubernetes}\"\u003e\n                \u003cstack name=\"relay-global\"\u003e\n                    \u003ctransport type=\"TCP\" socket-binding=\"jgroups-tcp-relay\"\u003e\n                        \u003cproperty name=\"external_addr\"\u003e${jboss.bind.ext_address:127.0.0.1}\u003c/property\u003e\n                    \u003c/transport\u003e\n                    \u003cprotocol type=\"TCPPING\"\u003e\n                        \u003cproperty name=\"initial_hosts\"\u003e${jboss.relay.global_cluster:127.0.0.1[55200]}\u003c/property\u003e\n                    \u003c/protocol\u003e\n                    \u003cprotocol type=\"MERGE3\"/\u003e\n                    \u003cprotocol type=\"FD_SOCK\" socket-binding=\"jgroups-tcp-fd\"\u003e\n                        \u003cproperty name=\"external_addr\"\u003e${jboss.bind.ext_address:127.0.0.1}\u003c/property\u003e\n                    \u003c/protocol\u003e\n                    \u003cprotocol type=\"FD_ALL\"\u003e\n                        \u003c!-- The timeout after which we suspect P --\u003e\n                        \u003c!-- Let use 3 mins = 180 s --\u003e\n                        \u003cproperty name=\"timeout\"\u003e180000\u003c/property\u003e\n                    \u003c/protocol\u003e\n                    \u003cprotocol type=\"VERIFY_SUSPECT\"/\u003e\n                    \u003cprotocol type=\"pbcast.NAKACK2\"\u003e\n                        \u003cproperty name=\"use_mcast_xmit\"\u003efalse\u003c/property\u003e\n                    \u003c/protocol\u003e\n                    \u003cprotocol type=\"UNICAST3\"/\u003e\n                    \u003cprotocol type=\"pbcast.STABLE\"/\u003e\n                    \u003cprotocol type=\"pbcast.GMS\"/\u003e\n                    \u003cprotocol type=\"MFC\"/\u003e\n                \u003c/stack\u003e\n                \u003cstack name=\"kubernetes\"\u003e\n                    \u003ctransport type=\"TCP\" socket-binding=\"jgroups-tcp\"\u003e\n                        \u003cproperty name=\"logical_addr_cache_expiration\"\u003e360000\u003c/property\u003e\n                    \u003c/transport\u003e\n                    \u003cprotocol type=\"kubernetes.KUBE_PING\"/\u003e\n                    \u003cprotocol type=\"MERGE3\"/\u003e\n                    \u003cprotocol type=\"FD_SOCK\" socket-binding=\"jgroups-tcp-fd\"/\u003e\n                    \u003cprotocol type=\"FD_ALL\"/\u003e\n                    \u003cprotocol type=\"VERIFY_SUSPECT\"/\u003e\n                    \u003cprotocol type=\"pbcast.NAKACK2\"\u003e\n                        \u003cproperty name=\"use_mcast_xmit\"\u003efalse\u003c/property\u003e\n                    \u003c/protocol\u003e\n                    \u003cprotocol type=\"UNICAST3\"/\u003e\n                    \u003cprotocol type=\"pbcast.STABLE\"/\u003e\n                    \u003cprotocol type=\"pbcast.GMS\"/\u003e\n                    \u003cprotocol type=\"MFC\"/\u003e\n                    \u003cprotocol type=\"FRAG3\"/\u003e\n                    \u003crelay site=\"${jboss.relay.site:stage}\"\u003e\n                        \u003cremote-site name=\"Azure\" stack=\"relay-global\" cluster=\"global\"/\u003e\n                        \u003cremote-site name=\"Amazon\" stack=\"relay-global\" cluster=\"global\"/\u003e\n                        \u003cremote-site name=\"Private\" stack=\"relay-global\" cluster=\"global\"/\u003e\n                        \u003cproperty name=\"relay_multicasts\"\u003efalse\u003c/property\u003e\n                        \u003cproperty name=\"max_site_masters\"\u003e1000\u003c/property\u003e\n                    \u003c/relay\u003e\n                \u003c/stack\u003e\n            \u003c/stacks\u003e\n        \u003c/subsystem\u003e\n        \u003csubsystem xmlns=\"urn:jboss:domain:io:2.0\"\u003e\n            \u003cworker name=\"default\"/\u003e\n            \u003cbuffer-pool name=\"default\"/\u003e\n        \u003c/subsystem\u003e\n        \u003csubsystem xmlns=\"urn:jboss:domain:jca:5.0\"\u003e\n            \u003carchive-validation enabled=\"true\" fail-on-error=\"true\" fail-on-warn=\"false\"/\u003e\n            \u003cbean-validation enabled=\"true\"/\u003e\n            \u003cdefault-workmanager\u003e\n                \u003cshort-running-threads\u003e\n                    \u003ccore-threads count=\"50\"/\u003e\n                    \u003cqueue-length count=\"50\"/\u003e\n                    \u003cmax-threads count=\"50\"/\u003e\n                    \u003ckeepalive-time time=\"10\" unit=\"seconds\"/\u003e\n                \u003c/short-running-threads\u003e\n                \u003clong-running-threads\u003e\n                    \u003ccore-threads count=\"50\"/\u003e\n                    \u003cqueue-length count=\"50\"/\u003e\n                    \u003cmax-threads count=\"50\"/\u003e\n                    \u003ckeepalive-time time=\"10\" unit=\"seconds\"/\u003e\n                \u003c/long-running-threads\u003e\n            \u003c/default-workmanager\u003e\n            \u003ccached-connection-manager/\u003e\n        \u003c/subsystem\u003e\n        \u003csubsystem xmlns=\"urn:jboss:domain:jdr:1.0\"/\u003e\n        \u003csubsystem xmlns=\"urn:jboss:domain:jmx:1.3\"\u003e\n            \u003cexpose-resolved-model/\u003e\n            \u003cexpose-expression-model/\u003e\n            \u003cremoting-connector/\u003e\n        \u003c/subsystem\u003e\n        \u003csubsystem xmlns=\"urn:jboss:domain:naming:2.0\"\u003e\n            \u003cremote-naming/\u003e\n        \u003c/subsystem\u003e\n        \u003csubsystem xmlns=\"urn:jboss:domain:remoting:4.0\"\u003e\n            \u003cendpoint/\u003e\n            \u003chttp-connector name=\"http-remoting-connector\" connector-ref=\"default\" security-realm=\"ApplicationRealm\"/\u003e\n        \u003c/subsystem\u003e\n        \u003csubsystem xmlns=\"urn:jboss:domain:security:2.0\"\u003e\n            \u003csecurity-domains\u003e\n                \u003csecurity-domain name=\"other\" cache-type=\"default\"\u003e\n                    \u003cauthentication\u003e\n                        \u003clogin-module code=\"Remoting\" flag=\"optional\"\u003e\n                            \u003cmodule-option name=\"password-stacking\" value=\"useFirstPass\"/\u003e\n                        \u003c/login-module\u003e\n                        \u003clogin-module code=\"RealmDirect\" flag=\"required\"\u003e\n                            \u003cmodule-option name=\"password-stacking\" value=\"useFirstPass\"/\u003e\n                        \u003c/login-module\u003e\n                    \u003c/authentication\u003e\n                \u003c/security-domain\u003e\n                \u003csecurity-domain name=\"jboss-web-policy\" cache-type=\"default\"\u003e\n                    \u003cauthorization\u003e\n                        \u003cpolicy-module code=\"Delegating\" flag=\"required\"/\u003e\n                    \u003c/authorization\u003e\n                \u003c/security-domain\u003e\n                \u003csecurity-domain name=\"jboss-ejb-policy\" cache-type=\"default\"\u003e\n                    \u003cauthorization\u003e\n                        \u003cpolicy-module code=\"Delegating\" flag=\"required\"/\u003e\n                    \u003c/authorization\u003e\n                \u003c/security-domain\u003e\n                \u003csecurity-domain name=\"jaspitest\" cache-type=\"default\"\u003e\n                    \u003cauthentication-jaspi\u003e\n                        \u003clogin-module-stack name=\"dummy\"\u003e\n                            \u003clogin-module code=\"Dummy\" flag=\"optional\"/\u003e\n                        \u003c/login-module-stack\u003e\n                        \u003cauth-module code=\"Dummy\"/\u003e\n                    \u003c/authentication-jaspi\u003e\n                \u003c/security-domain\u003e\n            \u003c/security-domains\u003e\n        \u003c/subsystem\u003e\n        \u003csubsystem xmlns=\"urn:jboss:domain:transactions:4.0\"\u003e\n            \u003ccore-environment\u003e\n                \u003cprocess-id\u003e\n                    \u003cuuid/\u003e\n                \u003c/process-id\u003e\n            \u003c/core-environment\u003e\n            \u003crecovery-environment socket-binding=\"txn-recovery-environment\" status-socket-binding=\"txn-status-manager\"/\u003e\n            \u003cobject-store path=\"tx-object-store\" relative-to=\"jboss.server.data.dir\"/\u003e\n        \u003c/subsystem\u003e\n    \u003c/profile\u003e\n    \u003cinterfaces\u003e\n        \u003cinterface name=\"management\"\u003e\n            \u003cinet-address value=\"${jboss.bind.address.management:127.0.0.1}\"/\u003e\n        \u003c/interface\u003e\n        \u003cinterface name=\"public\"\u003e\n            \u003cinet-address value=\"${jboss.bind.address:127.0.0.1}\"/\u003e\n        \u003c/interface\u003e\n        \u003c!-- REST needs to bind to localhost since we want it to be available on oc port-forward --\u003e\n        \u003cinterface name=\"rest\"\u003e\n            \u003cinet-address value=\"0.0.0.0\"/\u003e\n        \u003c/interface\u003e\n    \u003c/interfaces\u003e\n    \u003csocket-binding-group name=\"standard-sockets\" default-interface=\"public\" port-offset=\"${jboss.socket.binding.port-offset:0}\"\u003e\n        \u003csocket-binding name=\"management-http\" interface=\"management\" port=\"${jboss.management.http.port:9990}\"/\u003e\n        \u003csocket-binding name=\"management-https\" interface=\"management\" port=\"${jboss.management.https.port:9993}\"/\u003e\n        \u003csocket-binding name=\"hotrod\" port=\"11222\"/\u003e\n        \u003csocket-binding name=\"hotrod-internal\" port=\"11223\"/\u003e\n        \u003csocket-binding name=\"hotrod-multi-tenancy\" port=\"11224\"/\u003e\n        \u003csocket-binding name=\"jgroups-mping\" port=\"0\" multicast-address=\"${jboss.default.multicast.address:234.99.54.14}\" multicast-port=\"45700\"/\u003e\n        \u003csocket-binding name=\"jgroups-tcp\" port=\"7600\"/\u003e\n        \u003csocket-binding name=\"jgroups-tcp-fd\" port=\"57600\"/\u003e\n        \u003csocket-binding name=\"jgroups-tcp-relay\" port=\"55200\" /\u003e\n        \u003csocket-binding name=\"memcached\" port=\"11211\"/\u003e\n        \u003csocket-binding name=\"rest\" port=\"8080\" interface=\"rest\" /\u003e\n        \u003csocket-binding name=\"rest-multi-tenancy\" port=\"8081\"/\u003e\n        \u003csocket-binding name=\"rest-ssl\" port=\"8443\"/\u003e\n        \u003csocket-binding name=\"txn-recovery-environment\" port=\"4712\"/\u003e\n        \u003csocket-binding name=\"txn-status-manager\" port=\"4713\"/\u003e\n        \u003csocket-binding name=\"websocket\" port=\"8181\"/\u003e\n        \u003coutbound-socket-binding name=\"remote-store-hotrod-server\"\u003e\n            \u003cremote-destination host=\"remote-host\" port=\"11222\"/\u003e\n        \u003c/outbound-socket-binding\u003e\n        \u003coutbound-socket-binding name=\"remote-store-rest-server\"\u003e\n            \u003cremote-destination host=\"remote-host\" port=\"8080\"/\u003e\n        \u003c/outbound-socket-binding\u003e\n    \u003c/socket-binding-group\u003e\n\u003c/server\u003e\n"
      }
    },
    {
      "apiVersion": "v1",
      "kind": "Service",
      "metadata": {
        "annotations": {
          "description": "Headless service for StatefulSets"
        },
        "labels": {
          "application": "${APPLICATION_NAME}"
        },
        "name": "${APPLICATION_NAME}-headless"
      },
      "spec": {
        "ports": [
          {
            "name": "http",
            "port": 8080,
            "targetPort": 8080
          },
          {
            "name": "hotrod",
            "port": 11222,
            "targetPort": 11222
          }
        ],
        "selector": {
          "deploymentConfig": "${APPLICATION_NAME}"
        },
        "clusterIP": "None"
      }
    },
    {
      "apiVersion": "v1",
      "kind": "Service",
      "metadata": {
        "annotations": {
          "description": "The JGroups ping port for clustering.",
          "service.alpha.kubernetes.io/tolerate-unready-endpoints": "true"
        },
        "labels": {
          "application": "${APPLICATION_NAME}"
        },
        "name": "${APPLICATION_NAME}-ping"
      },
      "spec": {
        "ports": [
          {
            "name": "ping",
            "port": 8888
          }
        ],
        "selector": {
          "deploymentConfig": "${APPLICATION_NAME}"
        },
        "clusterIP": "None"
      }
    },
    {
      "apiVersion": "v1",
      "kind": "Service",
      "metadata": {
        "annotations": {
          "description": "The web server's HTTP management port."
        },
        "labels": {
          "application": "${APPLICATION_NAME}"
        },
        "name": "${APPLICATION_NAME}-management"
      },
      "spec": {
        "ports": [
          {
            "port": 9990,
            "targetPort": 9990
          }
        ],
        "selector": {
          "deploymentConfig": "${APPLICATION_NAME}"
        }
      }
    },
    {
      "apiVersion": "apps/v1beta1",
      "kind": "StatefulSet",
      "metadata": {
        "labels": {
          "application": "${APPLICATION_NAME}"
        },
        "name": "${APPLICATION_NAME}"
      },
      "spec": {
        "serviceName": "${APPLICATION_NAME}-headless",
        "replicas": "${{NUMBER_OF_INSTANCES}}",
        "strategy": {
          "type": "Rolling",
          "rollingParams": {
            "updatePeriodSeconds": 20,
            "intervalSeconds": 20,
            "timeoutSeconds": 1200,
            "maxUnavailable": 1,
            "maxSurge": 1
          }
        },
        "template": {
          "metadata": {
            "labels": {
              "application": "${APPLICATION_NAME}",
              "deploymentConfig": "${APPLICATION_NAME}"
            },
            "name": "${APPLICATION_NAME}"
          },
          "spec": {
            "containers": [
              {
                "args": [
                  "custom/cloud.xml",
                  "-b",
                  "$(IP)",
                  "-Djboss.default.jgroups.stack=kubernetes",
                  "-Djboss.bind.ext_address=$(EXT_ADDR)",
                  "-Djboss.relay.site=$(SITE)",
                  "-Djboss.relay.global_cluster=$(DISCOVERY)",
                  "--debug"
                ],
                "env": [
                  {
                    "name": "MGMT_USER",
                    "value": "${MANAGEMENT_USER}"
                  },
                  {
                    "name": "MGMT_PASS",
                    "value": "${MANAGEMENT_PASSWORD}"
                  },
                  {
                    "name": "KUBERNETES_LABELS",
                    "value": "application=${APPLICATION_NAME}"
                  },
                  {
                    "name": "KUBERNETES_NAMESPACE",
                    "valueFrom": {
                      "fieldRef": {
                        "fieldPath": "metadata.namespace"
                      }
                    }
                  },
                  {
                    "name": "OPENSHIFT_DNS_PING_SERVICE_NAME",
                    "value": "${APPLICATION_NAME}-ping"
                  },
                  {
                    "name": "OPENSHIFT_DNS_PING_SERVICE_PORT",
                    "value": "8888"
                  },
                  {
                    "name": "IP",
                    "valueFrom": {
                      "fieldRef": {
                        "fieldPath": "status.podIP"
                      }
                    }
                  },
                  {
                    "name": "EXT_ADDR",
                    "valueFrom": {
                      "secretKeyRef": {
                        "name": "jdg-app",
                        "key": "EXT_ADDR"
                      }
                    }
                  },
                  {
                    "name": "SITE",
                    "valueFrom": {
                      "secretKeyRef": {
                        "name": "jdg-app",
                        "key": "SITE"
                      }
                    }
                  },
                  {
                    "name": "DISCOVERY",
                    "valueFrom": {
                      "secretKeyRef": {
                        "name": "jdg-app",
                        "key": "DISCOVERY"
                      }
                    }
                  }
                ],
                "image": "${IMAGE}",
                "livenessProbe": {
                  "exec": {
                    "command": [
                      "/usr/local/bin/is_running.sh"
                    ]
                  },
                  "initialDelaySeconds": 15,
                  "timeoutSeconds": 10,
                  "periodSeconds": 20,
                  "successThreshold": 1,
                  "failureThreshold": 500
                },
                "readinessProbe": {
                  "exec": {
                    "command": [
                      "/usr/local/bin/is_healthy.sh"
                    ]
                  },
                  "initialDelaySeconds": 17,
                  "timeoutSeconds": 10,
                  "periodSeconds": 20,
                  "successThreshold": 2,
                  "failureThreshold": 500
                },
                "name": "${APPLICATION_NAME}",
                "ports": [
                  {
                    "containerPort": 8080,
                    "name": "http",
                    "protocol": "TCP"
                  },
                  {
                    "containerPort": 8888,
                    "name": "ping",
                    "protocol": "TCP"
                  },
                  {
                    "containerPort": 11222,
                    "name": "hotrod",
                    "protocol": "TCP"
                  }
                ],
                "volumeMounts": [
                  {
                    "name": "${APPLICATION_NAME}-configuration",
                    "mountPath": "/opt/jboss/infinispan-server/standalone/configuration/custom"
                  }
                ],
                "resources": {
                  "requests": {
                    "cpu": "0.5",
                    "memory": "${TOTAL_CONTAINER_MEM}Mi"
                  },
                  "limits": {
                    "memory": "${TOTAL_CONTAINER_MEM}Mi"
                  }
                }
              }
            ],
            "volumes": [
              {
                "name": "${APPLICATION_NAME}-configuration",
                "configMap": {
                  "name": "${APPLICATION_NAME}-configuration"
                }
              }
            ],
            "serviceAccountName": "${APPLICATION_NAME}",
            "terminationGracePeriodSeconds": 30
          }
        },
        "triggers": [
          {
            "type": "ConfigChange"
          }
        ]
      }
    }
  ],
  "parameters": [
    {
      "description": "Namespace for the application. Note: The namespace is required for creating proper RoleBindings. Specifying wrong namespace will prevent cluster from forming.",
      "name": "NAMESPACE",
      "required": true,
      "value": "myproject"
    },
    {
      "description": "The name for the application.",
      "name": "APPLICATION_NAME",
      "displayName": "Application Name",
      "required": true,
      "value": "jdg-app"
    },
    {
      "description": "Infinispan image.",
      "name": "IMAGE",
      "required": true,
      "value": "slaskawi/jdg-summit-2"
    },
    {
      "description": "Number of instances in the cluster.",
      "name": "NUMBER_OF_INSTANCES",
      "displayName": "Number of Instances",
      "required": true,
      "value": "1"
    },
    {
      "description": "Total container memory in MiB.",
      "displayName": "Total Memory",
      "name": "TOTAL_CONTAINER_MEM",
      "required": false,
      "value": "3072"
    },
    {
      "description": "Username for accessing management console.",
      "name": "MANAGEMENT_USER",
      "required": true,
      "generate": "expression",
      "from": "[a-zA-Z0-9]{8}"
    },
    {
      "description": "Password for accessing management console.",
      "name": "MANAGEMENT_PASSWORD",
      "required": true,
      "generate": "expression",
      "from": "[a-zA-Z0-9]{8}"
    }
  ]
}
